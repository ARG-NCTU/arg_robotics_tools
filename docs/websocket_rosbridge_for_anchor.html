---

title: Websocket with rosbridge to get anchor distance data


keywords: fastai
sidebar: home_sidebar



nb_path: "07_websocket_rosbridge_for_anchor.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 07_websocket_rosbridge_for_anchor.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">roslibpy</span>
<span class="kn">import</span> <span class="nn">time</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">println</span><span class="p">(</span><span class="n">ros_list</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ros_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Empty&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ros_list</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">subscribe_callback</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">message</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#print(&quot;it&#39;s 0&quot;)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">host</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;input host IP: &quot;</span><span class="p">)</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">roslibpy</span><span class="o">.</span><span class="n">Ros</span><span class="p">(</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">9090</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Is ROS connected?&#39;</span><span class="p">,</span> <span class="n">client</span><span class="o">.</span><span class="n">is_connected</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>input host IP: 192.168.1.12
Is ROS connected? True
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">command</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;please input command(topic, node, service, subscriber quit): &#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;topic&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;topic&#39;</span><span class="p">)</span>
        <span class="n">topic</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_topics</span><span class="p">()</span>
        <span class="n">println</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span>

        
    <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">)</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_nodes</span><span class="p">()</span>
        <span class="n">println</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        
<span class="c1">#     elif command == &#39;service&#39;:</span>
<span class="c1">#         print(&#39;service&#39;)</span>
<span class="c1">#         service = client.get_services()</span>
<span class="c1">#         println(service)</span>
    
<span class="c1">#     elif command == &#39;para&#39;:</span>
<span class="c1">#         print(&#39;parameter&#39;)</span>
<span class="c1">#         para = client.get_params()</span>
<span class="c1">#         println(para)</span>
<span class="c1">#     elif command == &#39;publisher&#39;:</span>
<span class="c1">#         message_data = input(&#39;what message you want to publish&#39;)</span>
<span class="c1">#         talker = roslibpy.Topic(client, &#39;/chatter&#39;, &#39;std_msgs/String&#39;)</span>
<span class="c1">#         for i in range(1,100):</span>
<span class="c1">#             talker.publish(roslibpy.Message({&#39;data&#39;: message_data}))</span>
<span class="c1">#             print(&#39;Sending message...&#39;)</span>
<span class="c1">#             time.sleep(1)</span>
<span class="c1">#         talker.unadvertise()</span>
        
    <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;subscriber&#39;</span><span class="p">:</span>
        <span class="n">topic</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_topics</span><span class="p">()</span>
        <span class="n">println</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span>
        <span class="n">topic_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;what topic you want to listen&#39;</span><span class="p">)</span>
        <span class="n">topic_type</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_topic_type</span><span class="p">(</span><span class="n">topic_name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;type_is &#39;</span> <span class="o">+</span> <span class="n">topic_type</span><span class="p">)</span>
        <span class="n">listener</span> <span class="o">=</span> <span class="n">roslibpy</span><span class="o">.</span><span class="n">Topic</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">topic_name</span><span class="p">,</span> <span class="n">topic_type</span><span class="p">,</span> <span class="n">throttle_rate</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">listener</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">subscribe_callback</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;close&#39;</span><span class="p">:</span>
        <span class="n">listener</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="n">topic_name</span><span class="p">)</span>
         
    <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;quit&#39;</span><span class="p">:</span>
        <span class="n">client</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="k">break</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>please input command(topic, node, service, subscriber quit): subscriber
/client_count
/anchor01/ranges
/rosout
/rosout_agg
/connected_clients
/joy/set_feedback
/joy
/diagnostics
/anchor01/distance
what topic you want to listen/anchor01/distance
type_is std_msgs/Float64
{&#39;data&#39;: 3694.0}
{&#39;data&#39;: 0.0}
{&#39;data&#39;: 3661.0}
{&#39;data&#39;: 0.0}
{&#39;data&#39;: 3684.0}
{&#39;data&#39;: 0.0}
{&#39;data&#39;: 3708.0}
{&#39;data&#39;: 3708.0}
{&#39;data&#39;: 0.0}
{&#39;data&#39;: 0.0}
{&#39;data&#39;: 3642.0}
{&#39;data&#39;: 3698.0}
{&#39;data&#39;: 3680.0}
{&#39;data&#39;: 3694.0}
{&#39;data&#39;: 0.0}
{&#39;data&#39;: 0.0}
{&#39;data&#39;: 3694.0}
{&#39;data&#39;: 3698.0}
{&#39;data&#39;: 3703.0}
{&#39;data&#39;: 3694.0}
{&#39;data&#39;: 0.0}
{&#39;data&#39;: 0.0}
{&#39;data&#39;: 0.0}
{&#39;data&#39;: 3698.0}
{&#39;data&#39;: 0.0}
{&#39;data&#39;: 0.0}
{&#39;data&#39;: 3703.0}
{&#39;data&#39;: 3694.0}
{&#39;data&#39;: 3712.0}
{&#39;data&#39;: 0.0}
{&#39;data&#39;: 3741.0}
{&#39;data&#39;: 3698.0}
{&#39;data&#39;: 3694.0}
{&#39;data&#39;: 3717.0}
{&#39;data&#39;: 3698.0}
{&#39;data&#39;: 3670.0}
{&#39;data&#39;: 3661.0}
{&#39;data&#39;: 3750.0}
{&#39;data&#39;: 3703.0}
{&#39;data&#39;: 3661.0}
{&#39;data&#39;: 0.0}
{&#39;data&#39;: 0.0}
{&#39;data&#39;: 0.0}
{&#39;data&#39;: 0.0}
{&#39;data&#39;: 3694.0}
{&#39;data&#39;: 3694.0}
{&#39;data&#39;: 3684.0}
{&#39;data&#39;: 3689.0}
{&#39;data&#39;: 0.0}
{&#39;data&#39;: 3694.0}
{&#39;data&#39;: 3689.0}
{&#39;data&#39;: 3694.0}
{&#39;data&#39;: 3712.0}
{&#39;data&#39;: 3680.0}
{&#39;data&#39;: 3680.0}
{&#39;data&#39;: 3712.0}
{&#39;data&#39;: 3708.0}
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
Input <span class="ansi-green-fg">In [4]</span>, in <span class="ansi-cyan-fg">&lt;cell line: 2&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-bold" style="color: rgb(0,135,0)">while</span> <span class="ansi-bold" style="color: rgb(0,135,0)">True</span>:
<span class="ansi-green-fg">----&gt; 2</span>     command <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">input</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">please input command(topic, node, service, subscriber quit): </span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> command <span style="color: rgb(98,98,98)">==</span> <span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">topic</span><span style="color: rgb(175,0,0)">&#39;</span>:
<span class="ansi-green-intense-fg ansi-bold">      4</span>         <span style="color: rgb(0,135,0)">print</span>(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">topic</span><span style="color: rgb(175,0,0)">&#39;</span>)

File <span class="ansi-green-fg">/usr/local/lib/python3.8/dist-packages/ipykernel/kernelbase.py:1165</span>, in <span class="ansi-cyan-fg">Kernel.raw_input</span><span class="ansi-blue-fg">(self, prompt)</span>
<span class="ansi-green-intense-fg ansi-bold">   1161</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_allow_stdin:
<span class="ansi-green-intense-fg ansi-bold">   1162</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> StdinNotImplementedError(
<span class="ansi-green-intense-fg ansi-bold">   1163</span>         <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">raw_input was called, but this frontend does not support input requests.</span><span style="color: rgb(175,0,0)">&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">   1164</span>     )
<span class="ansi-green-fg">-&gt; 1165</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_input_request</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-intense-fg ansi-bold">   1166</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">str</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">prompt</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   1167</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_parent_ident</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#34;</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">shell</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#34;</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   1168</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">get_parent</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#34;</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">shell</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#34;</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   1169</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">password</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">False</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   1170</span> <span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">/usr/local/lib/python3.8/dist-packages/ipykernel/kernelbase.py:1207</span>, in <span class="ansi-cyan-fg">Kernel._input_request</span><span class="ansi-blue-fg">(self, prompt, ident, parent, password)</span>
<span class="ansi-green-intense-fg ansi-bold">   1204</span>             <span class="ansi-bold" style="color: rgb(0,135,0)">break</span>
<span class="ansi-green-intense-fg ansi-bold">   1205</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> <span class="ansi-bold" style="color: rgb(215,95,95)">KeyboardInterrupt</span>:
<span class="ansi-green-intense-fg ansi-bold">   1206</span>     <span style="color: rgb(95,135,135)"># re-raise KeyboardInterrupt, to truncate traceback</span>
<span class="ansi-green-fg">-&gt; 1207</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">KeyboardInterrupt</span>(<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">Interrupted by user</span><span style="color: rgb(175,0,0)">&#34;</span>) <span class="ansi-bold" style="color: rgb(0,135,0)">from</span> <span style="color: rgb(0,135,0)">None</span>
<span class="ansi-green-intense-fg ansi-bold">   1208</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> <span class="ansi-bold" style="color: rgb(215,95,95)">Exception</span>:
<span class="ansi-green-intense-fg ansi-bold">   1209</span>     <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>log<span style="color: rgb(98,98,98)">.</span>warning(<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">Invalid Message:</span><span style="color: rgb(175,0,0)">&#34;</span>, exc_info<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">True</span>)

<span class="ansi-red-fg">KeyboardInterrupt</span>: Interrupted by user</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>


